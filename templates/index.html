<!DOCTYPE html><html lang="pt-br"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Kratos System Finan√ßas Pessoais</title><link rel="icon" href="/static/logo.png"><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script><script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script><style>:root{--azul:#163772;--azul-claro:#2a4172;--preto:#0b101e;--card-dark:#182336;--cinza:#232a39;--verde:#24c176;--vermelho:#e14c54;--amarelo:#ffd26e;--text-dark:#e6eefc;--sidebar:#131b2d;--sidebar-active:#222b44}html,body{margin:0;padding:0;height:100%}body{font-family:'Segoe UI',Arial,sans-serif;background:var(--cinza);min-height:100vh;color:var(--text-dark);box-sizing:border-box}#authLayer,#mainApp{width:100vw}.auth-bg{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--cinza)}.auth-card{background:var(--sidebar-active);padding:2.3rem 1.7rem 1.2rem;border-radius:1.4rem;min-width:300px;box-shadow:0 8px 32px #0002;display:flex;flex-direction:column;align-items:center}.auth-card img{width:64px;margin-bottom:1rem}.auth-card h2{margin-bottom:.4rem}.auth-card form label{display:block;margin-bottom:1rem}.auth-card input[type="password"],.auth-card input[type="text"]{padding:.6rem;border-radius:.7rem;border:1px solid #2b3552;background:#171f2e;color:var(--text-dark);width:98%;margin-bottom:.3rem}.auth-card button{background:var(--azul);color:#fff;border:none;border-radius:1rem;font-size:1.08rem;padding:.6rem 1.5rem;cursor:pointer;margin-top:.7rem}.auth-card .alt-link{color:var(--verde);cursor:pointer;text-decoration:underline;margin-top:.8rem}.auth-card small{display:block;color:#aaa;margin-top:1.5rem}.container{display:flex;min-height:100vh;width:100vw;overflow-x:hidden}aside.sidebar{background:var(--sidebar);color:#e6eefc;width:230px;min-width:160px;padding:2.2rem 1rem 1rem;display:flex;flex-direction:column;align-items:center;transition:left .2s;z-index:10;position:relative}.logo{width:56px;margin-bottom:1rem;border-radius:50%;background:#fff}.sidebar h1{font-size:1.18rem;margin:0 0 .2rem}.sidebar h2{font-size:1.01rem;margin-bottom:1.1rem;font-weight:400}.sidebar nav ul{list-style:none;padding:0;width:100%}.sidebar nav li{padding:.67rem 1rem;border-radius:1rem;margin-bottom:.37rem;text-align:center;cursor:pointer;transition:background .15s}.sidebar nav li.active,.sidebar nav li:hover{background:var(--sidebar-active);font-weight:700;color:var(--amarelo)}.sidebar .logout-btn{background:var(--vermelho);color:#fff;border:none;border-radius:1rem;margin-top:2rem;padding:.5rem 1.2rem;cursor:pointer;font-weight:700;width:100%}.main{flex:1;padding:2.2rem 1rem;min-width:0;width:100%}.panel{display:none}.panel.active{display:block;animation:fadeIn .4s}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.resume-cards{display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:1.7rem}.card{background:var(--card-dark);padding:.8rem 1.4rem;border-radius:1.2rem;box-shadow:0 2px 10px #0001;min-width:120px;flex:1 0 120px;display:flex;flex-direction:column;align-items:center}.card.receita{border-bottom:3px solid var(--verde)}.card.despesa{border-bottom:3px solid var(--vermelho)}.card.total{border-bottom:3px solid var(--azul)}.card span{color:#8c9fc5;margin-bottom:.3rem}.card strong{font-size:1.24rem}.transactions-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.7rem}.transactions-header button{background:var(--azul);color:#fff;border:none;padding:.36rem 1rem;border-radius:.9rem;font-size:.98rem;cursor:pointer}.filters{display:flex;gap:.6rem;margin-bottom:.7rem;flex-wrap:wrap}.filters input,.filters select{padding:.37rem;border-radius:.7rem;border:1px solid #2b3552;font-size:1rem;background:#131a2b;color:var(--text-dark)}#transactionsTable{width:100%;background:var(--card-dark);border-radius:1rem;box-shadow:0 2px 10px #0001;overflow:hidden}#transactionsTable th,#transactionsTable td{padding:.63rem .3rem;text-align:left;font-size:1rem}#transactionsTable th{background:var(--azul-claro);color:var(--amarelo)}#transactionsTable td button{background:none;border:none;color:var(--azul);cursor:pointer;font-size:1.07rem}#transactionsTable tr.income td{color:var(--verde)}#transactionsTable tr.expense td{color:var(--vermelho)}.modal-bg{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:#000b;align-items:center;justify-content:center;z-index:50}.modal-bg.active{display:flex}.modal{background:var(--card-dark);color:var(--text-dark);border-radius:1rem;padding:1.5rem 1rem;min-width:290px;box-shadow:0 8px 32px #0003;display:flex;flex-direction:column;gap:1rem;max-width:95vw}.modal form label{display:flex;flex-direction:column;gap:.2rem;margin-bottom:.7rem;font-weight:500}.modal form input,.modal form select,.modal form textarea{padding:.4rem;border-radius:.5rem;border:1px solid #2b3552;font-size:1rem;background:#192132;color:var(--text-dark)}.modal form button{padding:.6rem 1.4rem;border-radius:.9rem;border:none;background:var(--azul);color:#fff;font-size:1rem;margin-right:.5rem;cursor:pointer;margin-top:.4rem}.modal form button[type=button]{background:#333;color:#eee}.fab{position:fixed;bottom:2.2rem;right:2rem;z-index:110;background:var(--azul);color:#fff;width:58px;height:58px;border-radius:50%;font-size:2.4rem;display:flex;align-items:center;justify-content:center;box-shadow:0 3px 16px #246bfd30;cursor:pointer}.fab:hover{background:#193b70}@media (max-width:750px){.container{flex-direction:column}aside.sidebar{position:fixed;left:-100vw;top:0;bottom:0;height:100vh;width:77vw;max-width:320px;min-width:160px;border-radius:0 1.7rem 1.7rem 0;box-shadow:8px 0 20px #0003;transition:left .22s;z-index:99}aside.sidebar.open{left:0}.main{padding:1.2rem .3rem}.resume-cards{flex-direction:column}.fab{bottom:1.3rem;right:1.3rem}}@media (max-width:420px){aside.sidebar{padding:1.5rem .5rem}.card{padding:.7rem .6rem}.auth-card{min-width:95vw}}.settings-group{margin-bottom:1.4rem}.settings-group button,.settings-group label,.settings-group input{font-size:1.04rem}.custom-file{display:inline-block;position:relative}.custom-file input[type=file]{opacity:0;position:absolute;left:0;top:0;width:100%;height:100%;cursor:pointer}</style></head><body><div id="authLayer"></div><div class="container" id="mainApp" style="display:none"></div><div class="fab" id="fabBtn" style="display:none;" title="Adicionar lan√ßamento" onclick="openModal()">+</div><div id="modal" class="modal-bg" onclick="closeModal(event)"></div><div id="alertaBox" style="display:none;position:fixed;top:10px;right:10px;z-index:9999;background:#e14c54;color:#fff;padding:1rem 2rem;border-radius:.7rem;font-weight:bold;box-shadow:0 2px 12px #0005"></div><script>const firebaseConfig={apiKey:"AIzaSyD32JNIb-IplbuAM8WD-Nw_P3gA5wNSNwY",authDomain:"kratosfinancas.firebaseapp.com",projectId:"kratosfinancas",storageBucket:"kratosfinancas.firebasestorage.app",messagingSenderId:"740158664268",appId:"1:740158664268:web:9e4583e75c94cbd90c0ee9"};firebase.initializeApp(firebaseConfig);const db=firebase.firestore(),auth=firebase.auth();let appData=null,userEmail=null;const MENUS=[{id:"dashboard",label:"Dashboard",icon:"üìä"},{id:"transactions",label:"Lan√ßamentos",icon:"üí∏"},{id:"metas",label:"Metas",icon:"üéØ"},{id:"contas",label:"Contas",icon:"üè¶"},{id:"categorias",label:"Categorias",icon:"üè∑Ô∏è"},{id:"relatorios",label:"Relat√≥rios",icon:"üìà"},{id:"configuracoes",label:"Configura√ß√µes",icon:"‚öôÔ∏è"}];function renderLogin(){document.getElementById("authLayer").innerHTML='<div class="auth-bg"><div class="auth-card"><img src="/static/logo.png" alt="Logo Kratos"><h2>Kratos System</h2><form id="loginForm"><label>Email:<br><input type="text" id="loginEmail" required autocomplete="username"></label><label>Senha:<br><input type="password" id="loginSenha" required autocomplete="current-password"></label><button type="submit">Entrar</button></form><div class="alt-link" onclick="renderRegister()">Cadastrar nova conta</div><small>Seus dados ficam protegidos na nuvem com Firebase</small></div></div>',document.getElementById("authLayer").style.display="block",document.getElementById("mainApp").style.display="none",document.getElementById("loginForm").onsubmit=function(e){e.preventDefault();const t=document.getElementById("loginEmail").value.trim(),a=document.getElementById("loginSenha").value;auth.signInWithEmailAndPassword(t,a).then(()=>{startApp()}).catch(e=>alert("Erro: "+(e.message||e)))}}function renderRegister(){document.getElementById("authLayer").innerHTML='<div class="auth-bg"><div class="auth-card"><img src="/static/logo.png" alt="Logo Kratos"><h2>Nova Conta</h2><form id="registerForm"><label>Email:<br><input type="text" id="regEmail" required autocomplete="username"></label><label>Senha:<br><input type="password" id="regSenha" required autocomplete="new-password"></label><button type="submit">Cadastrar</button></form><div class="alt-link" onclick="renderLogin()">J√° tem conta? Entrar</div></div></div>',document.getElementById("registerForm").onsubmit=function(e){e.preventDefault();const t=document.getElementById("regEmail").value.trim(),a=document.getElementById("regSenha").value;auth.createUserWithEmailAndPassword(t,a).then(()=>{startApp()}).catch(e=>alert("Erro: "+(e.message||e)))}}function logoutUser(){auth.signOut().then(()=>{renderLogin()})}function getModeloZerado(){return{user:userEmail,contas:[{nome:"Carteira",saldo:0,cor:"#246bfd"}],categorias:[{nome:"Sal√°rio",tipo:"income",cor:"#24c176"},{nome:"Alimenta√ß√£o",tipo:"expense",cor:"#e14c54"}],transacoes:[],metas:[],config:{theme:"dark",alertas:[],limites:{},excelSep:";"},anexos:{}}}function saveData(){db.collection("usuarios").doc(userEmail).set(appData)}auth.onAuthStateChanged(function(t){t?(userEmail=t.email,startApp()):renderLogin()});function startApp(){userEmail=auth.currentUser.email,db.collection("usuarios").doc(userEmail).get().then(function(t){appData=t.exists?t.data():getModeloZerado(),renderApp()})}function renderApp(){document.getElementById("mainApp").innerHTML='<aside class="sidebar" id="sidebar"><img src="/static/logo.png" alt="Logo Kratos" class="logo" onerror="this.style.display=\'none\'"><h1>Kratos System</h1><h2>Finan√ßas Pessoais</h2><nav><ul id="menuList"></ul></nav><button class="logout-btn" onclick="logoutUser()">Sair</button></aside><main class="main" id="mainPainel"><section id="dashboard" class="panel active"></section><section id="transactions" class="panel"></section><section id="metas" class="panel"></section><section id="contas" class="panel"></section><section id="categorias" class="panel"></section><section id="relatorios" class="panel"></section><section id="configuracoes" class="panel"></section></main>',document.getElementById("mainApp").style.display="flex",renderMenu(),showPanel("dashboard"),renderAllPainels(),document.getElementById("fabBtn").style.display="flex"}function renderMenu(){let t=document.getElementById("menuList");t.innerHTML="",MENUS.forEach(e=>{t.innerHTML+=`<li id="menu-${e.id}" onclick="showPanel('${e.id}')">${e.icon} ${e.label}</li>`})}function showPanel(t){document.querySelectorAll(".panel").forEach(e=>e.classList.remove("active"));let e=document.getElementById(t);e&&e.classList.add("active"),document.querySelectorAll(".sidebar nav li").forEach(e=>e.classList.remove("active"));let a=document.getElementById("menu-"+t);a&&a.classList.add("active"),window.innerWidth<750&&toggleMenu(!0),window["render_"+t]&&window["render_"+t]()}function toggleMenu(t){const e=document.getElementById("sidebar");e&&(t?e.classList.remove("open"):e.classList.toggle("open"))}window.addEventListener("resize",()=>{if(window.innerWidth>=750){let t=document.getElementById("sidebar");t&&t.classList.remove("open")}}),document.addEventListener("keydown",function(t){"Escape"===t.key&&closeModal()});window.render_dashboard=function(){let t=document.getElementById("dashboard");if(!t)return;let e=(appData.contas||[]).reduce((t,e)=>t+Number(e.saldo||0),0),a=(appData.transacoes||[]).filter(t=>"income"===t.type).reduce((t,e)=>t+Number(e.value||0),0),n=(appData.transacoes||[]).filter(t=>"expense"===t.type).reduce((t,e)=>t+Number(e.value||0),0),r=[];e<0&&r.push("<b>Saldo negativo!</b> Voc√™ est√° no vermelho."),Object.entries(appData.config.limites||{}).forEach(([t,a])=>{let o=(appData.transacoes||[]).filter(e=>e.category===t&&"expense"===e.type).reduce((t,e)=>t+Number(e.value),0);a>0&&o>a&&r.push(`Aten√ß√£o: categoria <b>${t}</b> j√° passou do limite (${o.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})} / ${Number(a).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})`)}),t.innerHTML=`<h2>Resumo Financeiro</h2><div class="resume-cards"><div class="card total"><span>Saldo Atual</span><strong id="totalBalance">${e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</strong></div><div class="card receita"><span>Receitas</span><strong id="totalIncome">${a.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</strong></div><div class="card despesa"><span>Despesas</span><strong id="totalExpense">${n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</strong></div></div>${r.length?`<div style="margin-bottom:1rem;padding:1rem;background:#e14c54;color:#fff;border-radius:1rem;"><ul style="margin:0;padding-left:1.3rem">${r.map(a=>`<li>${a}</li>`).join("")}</ul></div>`:""}<canvas id="chart" width="350" height="160" style="max-width:99vw"></canvas><div style="margin-top:1.6rem;"><b>Dicas r√°pidas:</b><ul style="color:#ffd26e;line-height:1.7"><li>Clique no bot√£o ‚Äú+‚Äù para registrar rapidamente uma receita, despesa ou transfer√™ncia.</li><li>Acompanhe suas <b>metas</b> na aba Metas üéØ e veja seu progresso mensal.</li><li>Adicione <b>contas</b> para controlar saldo em bancos, cart√µes, ou dinheiro f√≠sico.</li><li>Personalize categorias e defina <b>limites</b> para receber alertas.</li><li>Baixe backups regulares em <b>Configura√ß√µes</b> para nunca perder seus dados.</li></ul></div>`;let o={};(appData.transacoes||[]).filter(t=>"expense"===t.type).forEach(t=>{o[t.category]=(o[t.category]||0)+Number(t.value)});let s=document.getElementById("chart");window.dashChart&&window.dashChart.destroy(),window.dashChart=new Chart(s,{type:"doughnut",data:{labels:Object.keys(o),datasets:[{data:Object.values(o),backgroundColor:Object.keys(o).map((t,e)=>["#163772","#24c176","#e14c54","#ffd26e","#9b59b6","#16a085","#aaa"][e%7])}]},options:{plugins:{legend:{display:!0}}}})},window.render_transactions=function(){let t=document.getElementById("transactions");if(!t)return;let e='<option value="">Todos</option><option value="income">Receitas</option><option value="expense">Despesas</option><option value="transfer">Transfer√™ncias</option>',a='<option value="">Todas</option>'+(appData.contas||[]).map(t=>`<option value="${t.nome}">${t.nome}</option>`).join(""),n='<option value="">Todas</option>'+(appData.categorias||[]).map(t=>`<option value="${t.nome}">${t.nome}</option>`).join(""),r=window.filtroTipoTx||"",o=window.filtroContaTx||"",s=window.filtroCatTx||"",i=window.filtroMesTx||"",l=window.filtroBuscaTx||"";t.innerHTML=`<div class="transactions-header"><h2>Lan√ßamentos</h2><button onclick="openModal()">+ Novo</button></div><div class="filters"><select id="filtroTipoTx">${e}</select><select id="filtroContaTx">${a}</select><select id="filtroCatTx">${n}</select><input type="month" id="filtroMesTx" style="max-width:150px"><input type="text" id="filtroBuscaTx" placeholder="Buscar..." style="max-width:150px"></div><table id="transactionsTable"><thead><tr><th>Tipo</th><th>Conta</th><th>Categoria</th><th>Descri√ß√£o</th><th>Data</th><th>Valor</th><th></th></tr></thead><tbody id="transactionsTBody"></tbody></table>`,document.getElementById("filtroTipoTx").value=r,document.getElementById("filtroContaTx").value=o,document.getElementById("filtroCatTx").value=s,document.getElementById("filtroMesTx").value=i,document.getElementById("filtroBuscaTx").value=l,document.getElementById("filtroTipoTx").onchange=e=>{window.filtroTipoTx=e.target.value,render_transactions()},document.getElementById("filtroContaTx").onchange=e=>{window.filtroContaTx=e.target.value,render_transactions()},document.getElementById("filtroCatTx").onchange=e=>{window.filtroCatTx=e.target.value,render_transactions()},document.getElementById("filtroMesTx").onchange=e=>{window.filtroMesTx=e.target.value,render_transactions()},document.getElementById("filtroBuscaTx").oninput=e=>{window.filtroBuscaTx=e.target.value,render_transactions()};let d=appData.transacoes||[];window.filtroTipoTx&&(d=d.filter(t=>t.type===window.filtroTipoTx)),window.filtroContaTx&&(d=d.filter(t=>t.account===window.filtroContaTx||t.accountTo===window.filtroContaTx)),window.filtroCatTx&&(d=d.filter(t=>t.category===window.filtroCatTx)),window.filtroMesTx&&(d=d.filter(t=>t.date&&t.date.startsWith(window.filtroMesTx))),window.filtroBuscaTx&&(d=d.filter(t=>(t.category||"").toLowerCase().includes(window.filtroBuscaTx.toLowerCase())||(t.description||"").toLowerCase().includes(window.filtroBuscaTx.toLowerCase())||(t.account||"").toLowerCase().includes(window.filtroBuscaTx.toLowerCase()))),d=d.slice().sort((t,e)=>e.date.localeCompare(t.date));let c=document.getElementById("transactionsTBody");c.innerHTML="",d.length?d.forEach((e,a)=>{let n="income"===e.type?"üü¢":"expense"===e.type?"üî¥":"üîÑ",r="income"===e.type?"var(--verde)":"expense"===e.type?"var(--vermelho)":"#aaa",o=Number(e.value).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),s=e.anexoId?`<button title="Ver anexo" onclick="verAnexo('${e.anexoId}')">üìé</button>`:"",i=e.notes?`<button title="Ver nota" onclick="verNota('${e.notes.replace(/'/g,"\\'")}')">üìù</button>`:"";c.innerHTML+=`<tr><td>${n}</td><td>${e.account||""}${e.accountTo?" ‚Üí "+e.accountTo:""}</td><td>${e.category||""}</td><td>${e.description||""}</td><td>${e.date||""}</td><td style="color:${r}">${o}</td><td>${s} ${i}<button title="Editar" onclick="openModal(${appData.transacoes.indexOf(e)})">‚úèÔ∏è</button><button title="Excluir" onclick="deleteTransaction(${appData.transacoes.indexOf(e)})">üóëÔ∏è</button></td></tr>`}):c.innerHTML='<tr><td colspan="7" style="text-align:center;color:#888">Nenhum lan√ßamento.</td></tr>'},window.verAnexo=function(t){let e=appData.anexos&&appData.anexos[t];if(!e)return alert("Arquivo n√£o encontrado.");let a=window.open();a.document.write(`<html><body style="margin:0;text-align:center;background:#000"><img src="${e}" style="max-width:99vw;max-height:99vh"></body></html>`)},window.verNota=function(t){alert(t)},window.render_metas=function(){let t=document.getElementById("metas");if(!t)return;let e=new Date().toISOString().slice(0,10),a=`<h2>Metas de Economia</h2><form id="formMeta" onsubmit="salvarMeta(event)" style="display:flex;gap:.6rem;flex-wrap:wrap;margin-bottom:1.3rem;align-items:flex-end;"><label>Nome da Meta<br><input type="text" id="metaNome" required maxlength="32" placeholder="Ex: Reserva de Emerg√™ncia"></label><label>Valor Alvo<br><input type="number" id="metaValor" min="1" step="0.01" required placeholder="R$"></label><label>Data Limite<br><input type="date" id="metaData" required min="${e}"></label><label>Conta<br><select id="metaConta" required>${appData.contas.map(t=>`<option>${t.nome}</option>`).join("")}</select></label><button type="submit">Salvar Meta</button></form>`,n=appData.metas||[],r=n.length?"":'<div style="color:#888;margin-top:1.4rem;">Nenhuma meta cadastrada.<br>Use o formul√°rio acima para criar sua primeira meta!</div>';n.forEach((e,a)=>{let n=appData.transacoes.filter(t=>t.account===e.conta&&"income"===t.type).reduce((t,e)=>t+Number(e.value),0),o=Math.min(100,Math.round(100*n/Number(e.valorAlvo||1))),s=e.dataLimite&&new Date(e.dataLimite)<new Date();r+=`<div style="background:#182336;${s?"opacity:.7;":""}border-radius:1.2rem;padding:1rem 1.3rem;margin-bottom:1.1rem;box-shadow:0 2px 10px #0001;max-width:99vw;"><div style="display:flex;justify-content:space-between;align-items:center;"><div><b style="font-size:1.1rem;">üéØ ${e.nome}</b><br><span style="color:#163772">${e.conta}</span></div><div><button onclick="editarMeta(${a})" title="Editar">‚úèÔ∏è</button><button onclick="excluirMeta(${a})" title="Excluir">üóëÔ∏è</button></div></div><div style="margin:.9rem 0 .5rem 0;"><div style="height:13px;border-radius:8px;background:#2a4172;width:100%;overflow:hidden;"><div style="background:#24c176;height:13px;width:${o}%;transition:.6s;"></div></div><span style="font-size:.98rem;">${n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})} / ${Number(e.valorAlvo).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})} (${o}%)${s?'<span style="color:#e14c54;margin-left:8px;">Vencida</span>':""}</span></div><div style="font-size:.95rem;color:#888">At√©: ${e.dataLimite||"-"}</div></div>`}),t.innerHTML=a+r},window.salvarMeta=function(t){t.preventDefault();let e=document.getElementById("metaNome").value.trim(),a=Number(document.getElementById("metaValor").value),n=document.getElementById("metaData").value,r=document.getElementById("metaConta").value,o=appData.metas||[];null!=window.metaEditIdx?(o[window.metaEditIdx]={nome:e,valorAlvo:a,dataLimite:n,conta:r},window.metaEditIdx=null):o.push({nome:e,valorAlvo:a,dataLimite:n,conta:r}),appData.metas=o,saveData(),render_metas(),document.getElementById("formMeta").reset()},window.editarMeta=function(t){let e=appData.metas[t];document.getElementById("metaNome").value=e.nome,document.getElementById("metaValor").value=e.valorAlvo,document.getElementById("metaData").value=e.dataLimite,document.getElementById("metaConta").value=e.conta,window.metaEditIdx=t},window.excluirMeta=function(t){confirm("Excluir esta meta?")&&(appData.metas.splice(t,1),saveData(),render_metas())},window.render_contas=function(){let t=document.getElementById("contas");if(!t)return;let e=`<h2>Contas</h2><form id="formConta" onsubmit="salvarConta(event)" style="display:flex;gap:.6rem;flex-wrap:wrap;margin-bottom:1.3rem;align-items:flex-end;"><label>Nome da Conta<br><input type="text" id="contaNome" required maxlength="24" placeholder="Ex: Banco do Brasil"></label><label>Cor<br><input type="color" id="contaCor" value="#163772"></label><label>Saldo Inicial<br><input type="number" id="contaSaldo" step="0.01" required value="0"></label><button type="submit">Salvar Conta</button></form><button onclick="abrirTransferencia()" style="margin-bottom:1.6rem;background:#163772;color:#fff;border:none;padding:.5rem 1.2rem;border-radius:.9rem;">Transferir entre contas</button>`,a=appData.contas||[],n=a.length?"":'<div style="color:#888;margin-top:1.4rem;">Nenhuma conta cadastrada.<br>Use o formul√°rio acima para criar sua primeira conta!</div>',r=a.reduce((t,e)=>t+Number(e.saldo||0),0);a.forEach((e,a)=>{n+=`<div style="background:#182336;border-radius:1.2rem;padding:1.2rem 1.3rem;margin-bottom:1.1rem;box-shadow:0 2px 10px #0001;max-width:99vw;"><div style="display:flex;justify-content:space-between;align-items:center;"><div><span style="display:inline-block;width:14px;height:14px;background:${e.cor};border-radius:3px;margin-right:8px;"></span><b style="font-size:1.05rem;">${e.nome}</b></div><div><button onclick="editarConta(${a})" title="Editar">‚úèÔ∏è</button><button onclick="excluirConta(${a})" title="Excluir">üóëÔ∏è</button></div></div><div style="margin-top:.7rem;font-size:1.07rem;"><b>Saldo:</b> ${Number(e.saldo).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</div></div>`}),t.innerHTML=e+`<div style="font-size:1.07rem;margin-bottom:.5rem;"><b>Saldo geral:</b> ${r.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</div>`+n},window.salvarConta=function(t){t.preventDefault();let e=document.getElementById("contaNome").value.trim(),a=document.getElementById("contaCor").value,n=Number(document.getElementById("contaSaldo").value);if(!e)return;let r=appData.contas||[];null!=window.contaEditIdx?(r[window.contaEditIdx]={nome:e,cor:a,saldo:n},window.contaEditIdx=null):r.push({nome:e,cor:a,saldo:n}),appData.contas=r,saveData(),render_contas(),document.getElementById("formConta").reset()},window.editarConta=function(t){let e=appData.contas[t];document.getElementById("contaNome").value=e.nome,document.getElementById("contaCor").value=e.cor,document.getElementById("contaSaldo").value=e.saldo,window.contaEditIdx=t},window.excluirConta=function(t){confirm("Excluir esta conta? Isso pode apagar lan√ßamentos ligados a ela!")&&(appData.contas.splice(t,1),appData.transacoes=(appData.transacoes||[]).filter(e=>e.account!==appData.contas[t]?.nome&&e.accountTo!==appData.contas[t]?.nome),saveData(),render_contas())},window.abrirTransferencia=function(){let t=appData.contas||[];if(t.length<2)return void alert("Cadastre pelo menos duas contas!");let e=`<form onsubmit="fazerTransferencia(event)"><h3>Transfer√™ncia entre contas</h3><label>De:<select id="transfDe" required>${t.map(t=>`<option>${t.nome}</option>`).join("")}</select></label><label>Para:<select id="transfPara" required>${t.map(t=>`<option>${t.nome}</option>`).join("")}</select></label><label>Valor:<input type="number" id="transfValor" min="0.01" step="0.01" required></label><button type="submit">Transferir</button><button type="button" onclick="closeModal()">Cancelar</button></form>`;mostrarModal(e)},window.fazerTransferencia=function(t){t.preventDefault();let e=document.getElementById("transfDe").value,a=document.getElementById("transfPara").value,n=Number(document.getElementById("transfValor").value);if(e===a)return void alert("Contas devem ser diferentes.");let r=appData.contas.find(t=>t.nome===e),o=appData.contas.find(t=>t.nome===a);if(!r||!o)return alert("Conta n√£o encontrada.");if(n<=0||r.saldo<n)return alert("Saldo insuficiente.");r.saldo-=n,o.saldo+=n,appData.transacoes=appData.transacoes||[],appData.transacoes.push({type:"transfer",account:e,accountTo:a,category:"Transfer√™ncia",description:"Transfer√™ncia entre contas",date:new Date().toISOString().slice(0,10),value:n}),saveData(),closeModal(),render_contas(),render_dashboard()},window.mostrarModal=function(t){let e=document.getElementById("modal");e.innerHTML=`<div class="modal" onclick="event.stopPropagation()">${t}</div>`,e.classList.add("active"),e.style.display="flex"},window.closeModal=function(t){t&&t.target&&t.target.classList&&!t.target.classList.contains("modal-bg")||(document.getElementById("modal").classList.remove("active"),document.getElementById("modal").style.display="none",renderAllPainels())},window.openModal=function(t){let e="number"==typeof t,a=e?appData.transacoes[t]:{},n=a&&"transfer"===a.type;document.getElementById("modal").innerHTML='<div class="modal" onclick="event.stopPropagation()"><form id="transactionForm" onsubmit="saveTransaction(event)"><h3 id="modalTitle">'+(e?"Editar":"Novo")+' Lan√ßamento</h3><label>Tipo:<select id="txType" required><option value="income">Receita</option><option value="expense">Despesa</option><option value="transfer">Transfer√™ncia</option></select></label><label>Conta:<select id="txAccount" required>'+appData.contas.map(t=>`<option${a.account===t.nome?" selected":""}>${t.nome}</option>`).join("")+'</select></label><div id="accountToWrap" style="display:none"><label>Para Conta:<select id="txAccountTo">'+appData.contas.map(t=>`<option${a.accountTo===t.nome?" selected":""}>${t.nome}</option>`).join("")+'</select></label></div><label>Categoria:<select id="txCategory" required>'+appData.categorias.map(t=>`<option${a.category===t.nome?" selected":""}>${t.nome}</option>`).join("")+'</select></label><label>Descri√ß√£o:<input type="text" id="txDesc" maxlength="40" value="'+(a.description||"")+'" placeholder="Ex: Pix recebido"></label><label>Data:<input type="date" id="txDate" required value="'+(a.date||new Date().toISOString().slice(0,10))+'"></label><label>Valor:<input type="number" id="txValue" min="0.01" step="0.01" required value="'+(a.value||"")+'"></label><label>Notas:<textarea id="txNotes" maxlength="100" placeholder="Observa√ß√µes">'+(a.notes||"")+'</textarea></label><button type="submit">'+(e?"Salvar":"Adicionar")+'</button><button type="button" onclick="closeModal()">Cancelar</button></form></div>',document.getElementById("modal").classList.add("active"),document.getElementById("modal").style.display="flex",document.getElementById("txType").value=a.type||"income",document.getElementById("txType").onchange=function(){document.getElementById("accountToWrap").style.display="transfer"===this.value?"block":"none"},document.getElementById("txType").onchange(),e&&(window.txEditIdx=t)},window.saveTransaction=function(t){t.preventDefault();let e=document.getElementById("txType").value,a=document.getElementById("txAccount").value,n=document.getElementById("txCategory").value,r=document.getElementById("txDesc").value,o=document.getElementById("txDate").value,s=Number(document.getElementById("txValue").value),i=document.getElementById("txNotes").value,l="transfer"===e?document.getElementById("txAccountTo").value:"",d=appData.contas.find(t=>t.nome===a),c=l?appData.contas.find(t=>t.nome===l):null;if(!d||"transfer"===e&&!c)return alert("Conta inv√°lida.");if("income"===e)d.saldo+=s;else if("expense"===e)d.saldo-=s;else if("transfer"===e)d.saldo-=s,c.saldo+=s;let u={type:e,account:a,category:n,description:r,date:o,value:s,notes:i};"transfer"===e&&(u.accountTo=l),null!=window.txEditIdx?(appData.transacoes[window.txEditIdx]=u,window.txEditIdx=null):appData.transacoes.push(u),saveData(),closeModal(),render_transactions(),render_dashboard()},window.deleteTransaction=function(t){confirm("Excluir este lan√ßamento?")&&(appData.transacoes.splice(t,1),saveData(),render_transactions(),render_dashboard())},window.render_categorias=function(){let t=document.getElementById("categorias");if(!t)return;let e=`<h2>Categorias</h2><form id="formCat" onsubmit="salvarCategoria(event)" style="display:flex;gap:.7rem;flex-wrap:wrap;margin-bottom:1.1rem;align-items:flex-end;"><label>Nome<br><input type="text" id="catNome" required maxlength="20" placeholder="Ex: Sal√°rio"></label><label>Tipo<br><select id="catTipo"><option value="income">Receita</option><option value="expense">Despesa</option></select></label><label>Cor<br><input type="color" id="catCor" value="#163772"></label><button type="submit">Salvar</button></form>`,a=appData.categorias||[],n=a.length?"":'<div style="color:#888;margin-top:1.4rem;">Nenhuma categoria cadastrada.</div>';a.forEach((e,a)=>{n+=`<div style="background:#182336;border-radius:1.2rem;padding:.8rem 1.2rem;margin-bottom:.9rem;box-shadow:0 2px 10px #0001;max-width:99vw;"><div style="display:flex;justify-content:space-between;align-items:center;"><div><span style="display:inline-block;width:14px;height:14px;background:${e.cor};border-radius:3px;margin-right:8px;"></span><b>${e.nome}</b> <span style="color:#aaa">(${e.tipo=="income"?"Receita":"Despesa"})</span></div><div><button onclick="editarCategoria(${a})" title="Editar">‚úèÔ∏è</button><button onclick="excluirCategoria(${a})" title="Excluir">üóëÔ∏è</button></div></div></div>`}),t.innerHTML=e+n},window.salvarCategoria=function(t){t.preventDefault();let e=document.getElementById("catNome").value.trim(),a=document.getElementById("catTipo").value,n=document.getElementById("catCor").value,r=appData.categorias||[];if(null!=window.catEditIdx)r[window.catEditIdx]={nome:e,tipo:a,cor:n},window.catEditIdx=null;else if(r.find(t=>t.nome==e))return alert("J√° existe uma categoria com esse nome!");else r.push({nome:e,tipo:a,cor:n});appData.categorias=r,saveData(),render_categorias(),document.getElementById("formCat").reset()},window.editarCategoria=function(t){let e=appData.categorias[t];document.getElementById("catNome").value=e.nome,document.getElementById("catTipo").value=e.tipo,document.getElementById("catCor").value=e.cor,window.catEditIdx=t},window.excluirCategoria=function(t){confirm("Excluir esta categoria?")&&(appData.categorias.splice(t,1),saveData(),render_categorias())},window.render_relatorios=function(){let t=document.getElementById("relatorios");if(!t)return;let e=(appData.transacoes||[]).filter(t=>"income"===t.type).reduce((t,e)=>t+Number(e.value),0),a=(appData.transacoes||[]).filter(t=>"expense"===t.type).reduce((t,e)=>t+Number(e.value),0),n=(appData.transacoes||[]).length,r=appData.transacoes.slice().sort((t,e)=>e.date.localeCompare(t.date)).slice(0,5);t.innerHTML=`<h2>Relat√≥rios</h2><div style="margin-bottom:1.2rem;">Receitas totais: <b>${e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</b> | Despesas totais: <b>${a.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</b> | Lan√ßamentos: <b>${n}</b></div><div><button onclick="exportarExcel()" style="background:#163772;color:#fff;border:none;padding:.6rem 1.1rem;border-radius:.9rem;margin-bottom:1.4rem;">Exportar para Excel</button></div><h4>√öltimos lan√ßamentos</h4><table style="width:100%;background:var(--card-dark);border-radius:.7rem;"><thead><tr><th>Tipo</th><th>Conta</th><th>Categoria</th><th>Valor</th><th>Data</th></tr></thead><tbody>${r.map(e=>`<tr><td>${e.type=="income"?"Receita":e.type=="expense"?"Despesa":"Transfer√™ncia"}</td><td>${e.account||""}</td><td>${e.category||""}</td><td>${Number(e.value).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td><td>${e.date||""}</td></tr>`).join("")}</tbody></table>`},window.exportarExcel=function(){let t=appData.transacoes||[],e=[["Tipo","Conta","Categoria","Descri√ß√£o","Data","Valor","Notas"]];t.forEach(t=>{e.push([t.type,t.account+(t.accountTo?" ‚Üí "+t.accountTo:""),t.category,t.description||"",t.date,Number(t.value||0),t.notes||""])});let a=XLSX.utils.aoa_to_sheet(e),n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,a,"Lan√ßamentos"),XLSX.writeFile(n,"lancamentos_kratos.xlsx")},window.render_configuracoes=function(){let t=document.getElementById("configuracoes");if(!t)return;let e=`<h2>Configura√ß√µes</h2><div class="settings-group"><label>Backup manual<br><button onclick="exportarBackup()">Baixar backup (.json)</button></label></div><div class="settings-group"><label>Importar backup<br><input type="file" onchange="importarBackup(event)" accept=".json"></label></div><div class="settings-group"><label>Limites de gasto por categoria<br>${(appData.categorias||[]).filter(t=>"expense"===t.tipo).map(t=>`<div><b>${t.nome}:</b> <input type="number" style="width:100px" value="${appData.config.limites[t.nome]||""}" onchange="salvarLimite('${t.nome}',this.value)" placeholder="R$"></div>`).join("")}</label></div>`,a=Object.keys(appData.config.limites||{}).length?`<div class="settings-group"><b>Limites atuais:</b><ul>${Object.entries(appData.config.limites||{}).map(([t,e])=>`<li>${t}: ${Number(e).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</li>`).join("")}</ul></div>`:"";t.innerHTML=e+a},window.salvarLimite=function(t,e){appData.config.limites=appData.config.limites||{},appData.config.limites[t]=Number(e),saveData()},window.exportarBackup=function(){let t=new Blob([JSON.stringify(appData,null,2)],{type:"application/json"}),e=document.createElement("a");e.href=URL.createObjectURL(t),e.download="kratos_financas_backup.json",e.click()},window.importarBackup=function(t){let e=t.target.files[0];if(!e)return;let a=new FileReader;a.onload=function(){try{let t=JSON.parse(a.result);if(!t.user)return alert("Backup inv√°lido!");appData=t,saveData(),alert("Backup importado! Recarregue a p√°gina.")}catch{alert("Erro ao importar!")}},a.readAsText(e)},window.renderAllPainels=function(){["dashboard","transactions","metas","contas","categorias","relatorios","configuracoes"].forEach(t=>window["render_"+t]&&window["render_"+t]())};</script></body></html>
