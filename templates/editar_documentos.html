<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Documentos do Cooperado ‚Äî {{ cooperado.nome }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root {
      --royal: #3047d6;
      --royal-soft: #eef2ff;
      --bg-soft: #f3f4f8;
      --card-border: #e4e7f0;
      --danger-soft: #ffe8e8;
      --success-soft: #e5fbf0;
    }

    body {
      background: radial-gradient(circle at top left, #f5f7ff 0, #f3f4f8 40%, #edf1ff 100%);
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .page-shell {
      max-width: 1100px;
      margin: 0 auto;
    }

    /* BOT√ÉO VOLTAR */
    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: 999px;
      border: 1px solid rgba(48, 71, 214, 0.13);
      padding: 0.4rem 0.9rem;
      font-size: 0.8rem;
      text-decoration: none;
      color: #4b5563;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
      transition: all 0.18s ease-out;
    }
    .btn-back i {
      font-size: 1rem;
    }
    .btn-back:hover {
      color: var(--royal);
      border-color: rgba(48, 71, 214, 0.3);
      box-shadow: 0 14px 32px rgba(30, 64, 175, 0.18);
      transform: translateY(-1px);
      background: #ffffff;
    }

    .section-title {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .section-subtitle {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .card-main {
      border-radius: 1.1rem;
      border: 1px solid var(--card-border);
      background: rgba(255, 255, 255, 0.96);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
      overflow: hidden;
    }

    .card-main-header {
      padding: 1.2rem 1.3rem 0.4rem 1.3rem;
      border-bottom: 0;
    }

    .avatar-lg {
      width: 60px;
      height: 60px;
      border-radius: 999px;
      object-fit: cover;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.18);
      border: 3px solid #fff;
    }

    .pill-tag {
      background: var(--royal-soft);
      color: var(--royal);
      border-radius: 999px;
      padding: 0.18rem 0.65rem;
      font-size: 0.73rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .pill-tag i {
      font-size: 0.85rem;
    }

    .deadline-chip {
      border-radius: 0.75rem;
      background: #0f172a;
      color: #f9fafb;
      padding: 0.5rem 0.85rem;
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .deadline-chip span.highlight {
      font-weight: 600;
      color: #e5e7eb;
    }

    .deadline-chip small {
      opacity: 0.85;
    }

    /* COLUNA ESQUERDA (RESUMO) */
    .summary-card {
      border-radius: 1rem;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top left, #eef2ff 0, #ffffff 40%);
    }

    .summary-list {
      list-style: none;
      padding-left: 0;
      margin-bottom: 0;
      font-size: 0.8rem;
    }

    .summary-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.25rem 0;
      border-bottom: 1px dashed rgba(148, 163, 184, 0.3);
    }

    .summary-list li:last-child {
      border-bottom: 0;
    }

    .summary-list span.label {
      color: #6b7280;
    }

    .summary-list span.value {
      font-weight: 500;
      color: #111827;
    }

    .badge-doc {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 0.12rem 0.65rem;
      border: 1px solid transparent;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .badge-doc-ok {
      background: var(--success-soft);
      color: #166534;
      border-color: #bbf7d0;
    }

    .badge-doc-pend {
      background: var(--danger-soft);
      color: #b91c1c;
      border-color: #fecaca;
    }

    /* FORM / CARDS DE DOCS */
    .doc-card {
      border-radius: 1rem;
      border: 1px solid var(--card-border);
      background: #ffffff;
    }

    .doc-card-header {
      padding: 0.85rem 1rem 0.5rem 1rem;
      border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    }

    .doc-label {
      font-size: 0.8rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .form-control-sm {
      font-size: 0.82rem;
      padding: 0.35rem 0.65rem;
      border-radius: 0.6rem;
    }

    .btn-group-sm > .btn {
      font-size: 0.8rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
    }

    .btn-pill {
      border-radius: 999px !important;
      font-size: 0.82rem;
      padding: 0.4rem 1rem;
    }

    .footer-alert {
      border-radius: 0.9rem;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      background: rgba(255, 255, 255, 0.9);
    }

    @media (max-width: 767.98px) {
      .card-main-header {
        padding-bottom: 0.8rem;
      }
    }
  </style>
</head>

<body>
  <div class="container py-4 page-shell">

    <!-- Voltar bonito para ABA ESCALAS -->
    <div class="mb-3 d-flex justify-content-between align-items-center">
      <a class="btn-back" href="{{ url_for('admin_dashboard') }}?tab=escalas">
        <i class="bi bi-arrow-left-short"></i>
        <span>Voltar para Escalas</span>
      </a>
      <span class="section-subtitle d-none d-sm-inline">
        Gest√£o de documentos do cooperado
      </span>
    </div>

    <!-- CONTE√öDO PRINCIPAL -->
    <div class="card-main">
      <!-- Cabe√ßalho com foto, nome e prazo -->
      <div class="card-main-header">
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
          <div class="d-flex gap-3 align-items-center">
            <img
              src="{{ cooperado.foto_url or url_for('static', filename='img/default.png') }}"
              alt="Foto cooperado"
              class="avatar-lg">
            <div>
              <div class="d-flex align-items-center gap-2 mb-1 flex-wrap">
                <h5 class="mb-0">{{ cooperado.nome }}</h5>
                <span class="pill-tag">
                  <i class="bi bi-person-badge"></i>
                  ID {{ cooperado.id }}
                </span>
              </div>
              <div class="section-subtitle">
                Atualize CNH e placa para manter o cooperado regular nas escalas.
              </div>
            </div>
          </div>

          <div class="d-flex flex-column align-items-md-end justify-content-between gap-2">
            <div class="deadline-chip">
              <i class="bi bi-calendar-event"></i>
              <div>
                <div>
                  Prazo-limite geral:
                  <span class="highlight">{{ docinfo.prazo_final.strftime('%d/%m/%Y') }}</span>
                </div>
                <small>
                  Faltam <b><span id="dias_restantes">{{ docinfo.dias_ate_prazo }}</span> dias</b> para o prazo final.
                </small>
              </div>
            </div>

            {% set tudo_ok = (docinfo.cnh.ok and docinfo.placa.ok) %}
            {% if tudo_ok %}
              <span class="badge-doc badge-doc-ok">
                <i class="bi bi-check2-circle"></i>
                Tudo em dia! Continue assim üëè
              </span>
            {% else %}
              <span class="badge-doc badge-doc-pend">
                <i class="bi bi-exclamation-triangle"></i>
                Existem pend√™ncias para regularizar.
              </span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Corpo -->
      <div class="p-3 p-md-4">
        <div class="row g-4">
          <!-- COL ESQUERDA: RESUMO -->
          <div class="col-12 col-lg-4">
            <div class="summary-card p-3 h-100 d-flex flex-column justify-content-between">
              <div>
                <div class="section-title mb-1">Resumo r√°pido</div>
                <div class="section-subtitle mb-3">
                  Vis√£o geral do status de documentos usados para liberar o cooperado na escala.
                </div>

                <ul class="summary-list mb-3">
                  <li>
                    <span class="label">Status CNH</span>
                    <span class="value">
                      {{ 'Em dia' if docinfo.cnh.ok else 'Pendente' }}
                    </span>
                  </li>
                  <li>
                    <span class="label">Venc. CNH</span>
                    <span class="value">
                      {% if docinfo.cnh.validade %}
                        {{ docinfo.cnh.validade.strftime('%d/%m') }}
                      {% else %}
                        ‚Äî
                      {% endif %}
                    </span>
                  </li>
                  <li>
                    <span class="label">Status Placa</span>
                    <span class="value">
                      {{ 'Em dia' if docinfo.placa.ok else 'Pendente' }}
                    </span>
                  </li>
                  <li>
                    <span class="label">Venc. Placa</span>
                    <span class="value">
                      {% if docinfo.placa.validade %}
                        {{ docinfo.placa.validade.strftime('%d/%m') }}
                      {% else %}
                        ‚Äî
                      {% endif %}
                    </span>
                  </li>
                  <li>
                    <span class="label">Prazo geral</span>
                    <span class="value">
                      {{ docinfo.prazo_final.strftime('%d/%m/%Y') }}
                    </span>
                  </li>
                </ul>
              </div>

              <div class="mt-2">
                <div class="section-subtitle mb-1">Dica r√°pida</div>
                <small class="section-subtitle">
                  Use o modo <b>Autom√°tico</b> quando quiser que o sistema calcule
                  o status com base na validade. Para casos especiais, force <b>Em dia</b> ou <b>Pendente</b>.
                </small>
              </div>
            </div>
          </div>

          <!-- COL DIREITA: FORMUL√ÅRIO -->
          <div class="col-12 col-lg-8">
            <form method="POST" class="row g-3 g-md-4">
              {% if csrf_token is defined %}
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              {% endif %}

              <!-- CNH -->
              <div class="col-12">
                <div class="doc-card">
                  <div class="doc-card-header d-flex justify-content-between align-items-center">
                    <div>
                      <span class="section-title">CNH</span>
                      <div class="section-subtitle">
                        N√∫mero, validade e modo de controle.
                      </div>
                    </div>
                    {% if docinfo.cnh.ok %}
                      <span class="badge-doc badge-doc-ok">
                        <i class="bi bi-check-circle"></i> Em dia
                      </span>
                    {% else %}
                      <span class="badge-doc badge-doc-pend">
                        <i class="bi bi-x-circle"></i> Pendente
                      </span>
                    {% endif %}
                  </div>

                  <div class="card-body row g-3">
                    <div class="col-12">
                      <label class="form-label doc-label">N√∫mero</label>
                      <input
                        type="text"
                        name="cnh_numero"
                        class="form-control form-control-sm"
                        value="{{ docinfo.cnh.numero or '' }}">
                    </div>

                    <div class="col-md-7">
                      <label class="form-label doc-label">Validade (m√™s/dia fixos, renova a cada ano)</label>
                      <input
                        type="date"
                        name="cnh_validade"
                        class="form-control form-control-sm"
                        value="{{ docinfo.cnh.validade.strftime('%Y-%m-%d') if docinfo.cnh.validade else '' }}">
                      {% if docinfo.cnh.prox_validade %}
                        <div class="small text-muted mt-1">
                          Pr√≥xima ocorr√™ncia anual:
                          <b>{{ docinfo.cnh.prox_validade.strftime('%d/%m/%Y') }}</b>
                        </div>
                      {% endif %}
                    </div>

                    <div class="col-md-5">
                      <label class="form-label doc-label d-block">Modo de controle</label>
                      <div class="btn-group btn-group-sm w-100" role="group">
                        <input
                          type="radio"
                          class="btn-check"
                          name="cnh_mode"
                          id="cnh_auto"
                          value="auto"
                          {{ 'checked' if docinfo.cnh.modo=='auto' else '' }}>
                        <label class="btn btn-outline-secondary w-100" for="cnh_auto">
                          Autom√°tico
                        </label>

                        <input
                          type="radio"
                          class="btn-check"
                          name="cnh_mode"
                          id="cnh_ok"
                          value="ok"
                          {{ 'checked' if docinfo.cnh.modo=='ok' else '' }}>
                        <label class="btn btn-outline-success w-100" for="cnh_ok">
                          Em dia
                        </label>

                        <input
                          type="radio"
                          class="btn-check"
                          name="cnh_mode"
                          id="cnh_pend"
                          value="pendente"
                          {{ 'checked' if docinfo.cnh.modo=='pendente' else '' }}>
                        <label class="btn btn-outline-danger w-100" for="cnh_pend">
                          Pendente
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- PLACA -->
              <div class="col-12">
                <div class="doc-card">
                  <div class="doc-card-header d-flex justify-content-between align-items-center">
                    <div>
                      <span class="section-title">Placa</span>
                      <div class="section-subtitle">
                        Placa do ve√≠culo e validade anual.
                      </div>
                    </div>
                    {% if docinfo.placa.ok %}
                      <span class="badge-doc badge-doc-ok">
                        <i class="bi bi-check-circle"></i> Em dia
                      </span>
                    {% else %}
                      <span class="badge-doc badge-doc-pend">
                        <i class="bi bi-x-circle"></i> Pendente
                      </span>
                    {% endif %}
                  </div>

                  <div class="card-body row g-3">
                    <div class="col-12">
                      <label class="form-label doc-label">Placa</label>
                      <input
                        type="text"
                        name="placa"
                        class="form-control form-control-sm"
                        value="{{ docinfo.placa.numero or '' }}"
                        placeholder="ABC1234 / ABC1D23">
                    </div>

                    <div class="col-md-7">
                      <label class="form-label doc-label">Validade (m√™s/dia fixos, renova a cada ano)</label>
                      <input
                        type="date"
                        name="placa_validade"
                        class="form-control form-control-sm"
                        value="{{ docinfo.placa.validade.strftime('%Y-%m-%d') if docinfo.placa.validade else '' }}">
                      {% if docinfo.placa.prox_validade %}
                        <div class="small text-muted mt-1">
                          Pr√≥xima ocorr√™ncia anual:
                          <b>{{ docinfo.placa.prox_validade.strftime('%d/%m/%Y') }}</b>
                        </div>
                      {% endif %}
                    </div>

                    <div class="col-md-5">
                      <label class="form-label doc-label d-block">Modo de controle</label>
                      <div class="btn-group btn-group-sm w-100" role="group">
                        <input
                          type="radio"
                          class="btn-check"
                          name="placa_mode"
                          id="placa_auto"
                          value="auto"
                          {{ 'checked' if docinfo.placa.modo=='auto' else '' }}>
                        <label class="btn btn-outline-secondary w-100" for="placa_auto">
                          Autom√°tico
                        </label>

                        <input
                          type="radio"
                          class="btn-check"
                          name="placa_mode"
                          id="placa_ok"
                          value="ok"
                          {{ 'checked' if docinfo.placa.modo=='ok' else '' }}>
                        <label class="btn btn-outline-success w-100" for="placa_ok">
                          Em dia
                        </label>

                        <input
                          type="radio"
                          class="btn-check"
                          name="placa_mode"
                          id="placa_pend"
                          value="pendente"
                          {{ 'checked' if docinfo.placa.modo=='pendente' else '' }}>
                        <label class="btn btn-outline-danger w-100" for="placa_pend">
                          Pendente
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- BOT√ïES -->
              <div class="col-12 d-flex flex-wrap gap-2 justify-content-end mt-2">
                <button class="btn btn-primary btn-pill">
                  <i class="bi bi-save me-1"></i>
                  Salvar altera√ß√µes
                </button>
                <a class="btn btn-outline-secondary btn-pill"
                   href="{{ url_for('admin_dashboard') }}?tab=escalas">
                  Cancelar
                </a>
              </div>
            </form>
          </div>
        </div>

        <!-- ALERTA FINAL -->
        <div class="mt-4">
          {% if docinfo.cnh.ok and docinfo.placa.ok %}
            <div class="alert alert-success footer-alert mb-0">
              <i class="bi bi-emoji-smile"></i>
              Parab√©ns! <b>CNH</b> e <b>Placa</b> est√£o em dia. Continue assim üëè
            </div>
          {% else %}
            <div class="alert alert-warning footer-alert mb-0">
              <i class="bi bi-hourglass-split"></i>
              Regularize as pend√™ncias at√©
              <b>{{ docinfo.prazo_final.strftime('%d/%m/%Y') }}</b>.
              Faltam <b><span id="dias_restantes2">{{ docinfo.dias_ate_prazo }}</span> dias</b>.
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <script>
    // Contagem regressiva em tempo real at√© o prazo final
    (function(){
      const diasEl1 = document.getElementById('dias_restantes');
      const diasEl2 = document.getElementById('dias_restantes2');
      function update() {
        const prazo = new Date(
          {{ docinfo.prazo_final.year }},
          {{ docinfo.prazo_final.month - 1 }},
          {{ docinfo.prazo_final.day }},
          23, 59, 59
        );
        const now = new Date();
        const diff = prazo - now;
        const dias = Math.max(0, Math.ceil(diff / (1000*60*60*24)));
        if (diasEl1) diasEl1.textContent = dias;
        if (diasEl2) diasEl2.textContent = dias;
      }
      update();
      setInterval(update, 60*1000);
    })();
  </script>
</body>
</html>
