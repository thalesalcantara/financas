<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#2563EB" />
  <title>Kratos System - Finance (Mobile)</title>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <style>
    :root{
      /* Tema claro */
      --bg:#f5f7fb;             /* fundo geral */
      --surface:#ffffff;         /* cart√µes */
      --line:#e6eaf4;            /* linhas/bordas */
      --text:#0f172a;            /* texto principal */
      --muted:#475569;           /* texto secund√°rio */
      --brand:#2563EB;           /* azul Kratos */
      --green:#16a34a;           /* sucesso */
      --red:#dc2626;             /* erro/danger */
      --yellow:#f59e0b;          /* aviso */
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
    img{display:block;max-width:100%}

    /* Containers */
    .screen{display:none;min-height:100dvh;padding-bottom:84px}
    .screen.active{display:block}
    .wrap{padding:16px}

    /* Topbar */
    .top{position:sticky;top:0;z-index:20;backdrop-filter:saturate(1.1) blur(8px);background:rgba(255,255,255,.85);border-bottom:1px solid var(--line)}
    .top-inner{display:flex;align-items:center;gap:12px;padding:12px 16px}
    .logo{height:28px;width:28px;border-radius:8px;border:1px solid var(--line);object-fit:cover;background:#fff}
    .brand{font-weight:800;letter-spacing:.2px}
    .hamb{appearance:none;border:1px solid var(--line);background:#fff;border-radius:10px;width:40px;height:40px;display:grid;place-items:center;font-size:18px}

    /* Drawer (menu lateral) */
    .drawer{position:fixed;inset:0;z-index:30;pointer-events:none}
    .drawer .dim{position:absolute;inset:0;background:rgba(0,0,0,.35);opacity:0;transition:.2s}
    .drawer .panel{position:absolute;left:0;top:0;bottom:0;width:78%;max-width:320px;background:#ffffff;border-right:1px solid var(--line);transform:translateX(-100%);transition:.2s;padding:16px 12px;display:flex;flex-direction:column;gap:8px}
    .drawer.open{pointer-events:auto}
    .drawer.open .dim{opacity:1}
    .drawer.open .panel{transform:translateX(0)}
    .nav a{display:flex;gap:10px;align-items:center;padding:12px;border-radius:12px;color:var(--text);text-decoration:none;border:1px solid var(--line)}
    .nav a.active, .nav a:hover{background:#f1f5ff;border-color:#cfe0ff}

    /* Cards e inputs */
    .card{background:var(--surface);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:0 6px 24px rgba(15,23,42,.06)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .col{display:flex;flex-direction:column;gap:8px}
    .kpi{font-size:22px;font-weight:800}
    .tag{font-weight:800}
    .tag.r{color:var(--green)}
    .tag.d{color:var(--red)}
    .muted{color:var(--muted)}
    label.small{font-size:12px;color:var(--muted)}
    input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#fff;color:var(--text);outline:none;min-height:44px}
    input:focus,select:focus,textarea:focus{border-color:#9ec1ff;box-shadow:0 0 0 3px rgba(37,99,235,.18)}

    .btn{appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:8px;min-height:44px}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.ghost{background:#fff;border:1px solid var(--line);color:var(--text)}
    .btn.warn{background:var(--yellow);color:#000}
    .btn.danger{background:var(--red);color:#fff}

    /* Lista */
    .list{display:flex;flex-direction:column}
    .item{display:flex;align-items:center;justify-content:space-between;padding:12px 10px;border-bottom:1px solid var(--line)}
    .it-left{display:flex;align-items:center;gap:10px}
    .bubble{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;font-weight:900}
    .b-r{background:#e8f7ee;border:1px solid #bfe8ce;color:#15803d}
    .b-d{background:#fdeaea;border:1px solid #f4c7c7;color:#b91c1c}
    .it-right{display:flex;gap:8px}
    .sm{font-size:12px;color:var(--muted)}

    /* Bottom nav (mobile) */
    .navb{position:fixed;left:0;right:0;bottom:0;z-index:20;background:#ffffffcc;backdrop-filter:blur(8px);border-top:1px solid var(--line)}
    .navb ul{margin:0;padding:8px 8px calc(8px + env(safe-area-inset-bottom));list-style:none;display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
    .navb button{appearance:none;border:1px solid var(--line);background:#fff;color:var(--muted);border-radius:12px;padding:10px 8px;display:flex;flex-direction:column;align-items:center;gap:6px;font-size:12px;font-weight:800}
    .navb button.active{color:#111827;background:#f8fbff;border-color:#cfe0ff}

    /* Auth */
    .center{min-height:100dvh;display:grid;place-items:center;padding:20px}
    .auth-card{width:100%;max-width:480px}
    .logo-big{height:56px;width:56px;border-radius:12px;border:1px solid var(--line);object-fit:cover;background:#fff}
    .seg{display:grid;grid-template-columns:1fr 1fr;background:#fff;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .seg button{appearance:none;border:0;padding:10px;color:var(--muted);font-weight:800;background:#fff}
    .seg button.active{background:#f1f5ff;color:#0f172a}

    .hidden{display:none!important}
  </style>
</head>
<body>
  <!-- DRAWER -->
  <div id="drawer" class="drawer">
    <div class="dim"></div>
    <aside class="panel">
      <div class="row" style="gap:10px;align-items:center">
        <img id="logoDr" class="logo" alt="Logo" src=""/>
        <div class="brand">KRATOS Finance</div>
      </div>
      <div class="nav" style="margin-top:12px">
        <a href="#" data-view="Resumo" class="active">üè† Resumo</a>
        <a href="#" data-view="Lanc">‚úö Lan√ßar</a>
        <a href="#" data-view="Lista">üìÑ Lista</a>
        <a href="#" data-view="Sim">üìà Simulador</a>
        <a href="#" id="btnSair">üö™ Sair</a>
      </div>
    </aside>
  </div>

  <!-- AUTH -->
  <section id="scrAuth" class="screen active">
    <div class="center">
      <div class="card auth-card">
        <div class="row" style="justify-content:center;gap:12px">
          <img id="logoBig" class="logo-big" alt="Kratos System" src=""/>
          <div class="col" style="gap:2px">
            <div class="brand">KRATOS SYSTEM</div>
            <div class="muted" style="font-weight:700">Finance ‚Ä¢ Acesso</div>
          </div>
        </div>
        <div style="height:8px"></div>
        <div class="seg">
          <button id="tabLogin" class="active">Entrar</button>
          <button id="tabRegister">Criar conta</button>
        </div>
        <div style="height:12px"></div>
        <div id="boxLogin" class="col">
          <label class="small">E-mail</label>
          <input id="inEmail" type="email" inputmode="email" autocomplete="username" placeholder="voce@email.com" />
          <label class="small">Senha</label>
          <input id="inPass" type="password" autocomplete="current-password" placeholder="********" />
          <button id="btnLogin" class="btn primary">Entrar</button>
          <div class="row" style="justify-content:center">
            <button id="btnGoogle" class="btn ghost">Google</button>
            <button id="btnApple" class="btn ghost">Apple</button>
          </div>
          <div id="errLogin" class="sm" style="color:#b91c1c"></div>
        </div>
        <div id="boxRegister" class="col hidden">
          <label class="small">Nome</label>
          <input id="regName" type="text" autocomplete="name" placeholder="Seu nome" />
          <label class="small">E-mail</label>
          <input id="regEmail" type="email" autocomplete="email" placeholder="voce@email.com" />
          <label class="small">Senha</label>
          <input id="regPass" type="password" autocomplete="new-password" placeholder="Crie uma senha" />
          <button id="btnRegister" class="btn primary">Criar e entrar</button>
          <div id="errReg" class="sm" style="color:#b91c1c"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- APP -->
  <section id="scrApp" class="screen">
    <div class="top">
      <div class="top-inner">
        <button id="btnHamb" class="hamb">‚ò∞</button>
        <img id="logoSm" class="logo" alt="Logo" src=""/>
        <div class="brand">KRATOS Finance</div>
        <div class="sm" style="margin-left:auto" id="userName"></div>
      </div>
    </div>

    <!-- Resumo -->
    <div id="viewResumo" class="wrap">
      <div class="row">
        <label class="small">M√™s</label>
        <input id="fltMonth" type="month" />
      </div>
      <div style="height:10px"></div>
      <div class="row">
        <div class="card" style="flex:1">
          <div class="muted">Saldo</div>
          <div id="kpiSaldo" class="kpi"></div>
          <div class="sm muted">Receitas - Despesas</div>
        </div>
        <div class="card" style="flex:1">
          <div class="muted">Receitas</div>
          <div id="kpiRec" class="kpi tag r"></div>
          <div class="sm muted">no per√≠odo</div>
        </div>
        <div class="card" style="flex:1">
          <div class="muted">Despesas</div>
          <div id="kpiDes" class="kpi tag d"></div>
          <div class="sm muted">no per√≠odo</div>
        </div>
      </div>
      <div style="height:12px"></div>
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div class="muted">√öltimos lan√ßamentos</div>
          <select id="fltCat" style="max-width:180px">
            <option value="">Todas categorias</option>
          </select>
        </div>
        <div id="listHome" class="list"></div>
      </div>
    </div>

    <!-- Lan√ßar -->
    <div id="viewLanc" class="wrap hidden">
      <div class="card col">
        <div class="row" style="gap:8px">
          <button id="btnTipoR" class="btn" style="flex:1;background:#e8f7ee;border:1px solid #bfe8ce;color:#166534">Receita</button>
          <button id="btnTipoD" class="btn" style="flex:1;background:#fdeaea;border:1px solid #f4c7c7;color:#991b1b">Despesa</button>
        </div>
        <input id="txDate" type="date" />
        <input id="txCat" type="text" placeholder="Categoria (ex: Sal√°rio, Mercado)" />
        <input id="txAmount" type="number" step="0.01" min="0" inputmode="decimal" placeholder="Valor" />
        <textarea id="txNote" rows="2" placeholder="Observa√ß√£o (opcional)"></textarea>
        <button id="btnSalvar" class="btn primary">Salvar lan√ßamento</button>
        <button id="btnCancelarEdit" class="btn ghost hidden">Cancelar edi√ß√£o</button>
        <div id="formInfo" class="sm muted"></div>
      </div>
    </div>

    <!-- Lista -->
    <div id="viewLista" class="wrap hidden">
      <div class="card">
        <div class="row" style="justify-content:space-between;gap:8px">
          <div class="row"><label class="small">Categoria</label>
            <select id="fltCat2" style="min-width:160px">
              <option value="">Todas</option>
            </select>
          </div>
          <button id="btnCSV" class="btn ghost">Exportar CSV</button>
        </div>
        <div id="listFull" class="list"></div>
      </div>
    </div>

    <!-- Simulador -->
    <div id="viewSim" class="wrap hidden">
      <div class="card col">
        <div class="row">
          <input id="simInicial" type="number" step="0.01" inputmode="decimal" placeholder="Aporte inicial" />
          <input id="simMensal" type="number" step="0.01" inputmode="decimal" placeholder="Aporte mensal" />
        </div>
        <div class="row">
          <input id="simTaxa" type="number" step="0.01" inputmode="decimal" placeholder="Taxa (% a.m.)" />
          <input id="simMeses" type="number" step="1" inputmode="numeric" placeholder="Meses" />
        </div>
        <button id="btnSimular" class="btn primary">Simular</button>
        <div id="simOut" class="muted"></div>
      </div>
    </div>

    <!-- Bottom Nav (atalhos) -->
    <nav class="navb">
      <ul>
        <li><button class="active" data-view="Resumo">üè†<span>Resumo</span></button></li>
        <li><button data-view="Lanc">‚úö<span>Lan√ßar</span></button></li>
        <li><button data-view="Lista">üìÑ<span>Lista</span></button></li>
        <li><button data-view="Sim">üìà<span>Simulador</span></button></li>
      </ul>
    </nav>
  </section>

  <script type="module">
    // ===== Firebase =====
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, OAuthProvider, signInWithPopup, updateProfile, signOut } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';
    import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, query, where, orderBy, onSnapshot, Timestamp, enableIndexedDbPersistence } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: 'AIzaSyD32JNIb-IplbuAM8WD-Nw_P3gA5wNSNwY',
      authDomain: 'kratosfinancas.firebaseapp.com',
      projectId: 'kratosfinancas',
      storageBucket: 'kratosfinancas.firebasestorage.app',
      messagingSenderId: '740158664268',
      appId: '1:740158664268:web:9e4583e75c94cbd90c0ee9'
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    enableIndexedDbPersistence(db).catch(()=>{});

    // ===== Helpers =====
    const $ = (s,root=document)=>root.querySelector(s);
    const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
    const brl = v => new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(Number(v||0));
    const fmtDate = d => new Date(d).toLocaleDateString('pt-BR');
    const ymd = (d)=>{ const x=new Date(d); return `${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,'0')}-${String(x.getDate()).padStart(2,'0')}` };

    // ===== LOGO =====
    // Op√ß√£o A (recomendada): coloque o arquivo em public/static/logo.png e use o caminho abaixo
    const LOGO_SRC = './static/logo.png';
    // Op√ß√£o B: se quiser 100% embutido, cole aqui a string base64 completa: const LOGO_SRC = 'data:image/png;base64,AAA...';
    $('#logoBig').src = LOGO_SRC; $('#logoSm').src = LOGO_SRC; $('#logoDr').src = LOGO_SRC;

    // ===== State =====
    let unsub = null; let txCache=[]; let editingId=null; let currentType='despesa';

    // ===== Drawer =====
    const drawer = $('#drawer'); const dim = drawer.querySelector('.dim'); const links = drawer.querySelectorAll('.nav a');
    const openDrawer = ()=> drawer.classList.add('open');
    const closeDrawer = ()=> drawer.classList.remove('open');
    $('#btnHamb').onclick = openDrawer; dim.onclick = closeDrawer;
    links.forEach(a=> a.onclick=(e)=>{ e.preventDefault(); links.forEach(x=>x.classList.remove('active')); a.classList.add('active'); showView(a.dataset.view); closeDrawer(); });

    // ===== Auth Tabs =====
    const tabLogin=$('#tabLogin'), tabRegister=$('#tabRegister');
    const boxLogin=$('#boxLogin'), boxRegister=$('#boxRegister');
    tabLogin.onclick=()=>{ tabLogin.classList.add('active'); tabRegister.classList.remove('active'); boxLogin.classList.remove('hidden'); boxRegister.classList.add('hidden'); };
    tabRegister.onclick=()=>{ tabRegister.classList.add('active'); tabLogin.classList.remove('active'); boxRegister.classList.remove('hidden'); boxLogin.classList.add('hidden'); };

    // ===== Auth Actions =====
    $('#btnLogin').onclick = async()=>{
      $('#errLogin').textContent=''; const btn=$('#btnLogin'); const old=btn.textContent; btn.disabled=true; btn.textContent='Entrando‚Ä¶';
      try{ await signInWithEmailAndPassword(auth, $('#inEmail').value, $('#inPass').value); }
      catch(e){ $('#errLogin').textContent = e.message.replace('Firebase:','').trim(); }
      finally{ btn.disabled=false; btn.textContent=old; }
    };
    $('#btnRegister').onclick = async()=>{
      $('#errReg').textContent=''; const btn=$('#btnRegister'); const old=btn.textContent; btn.disabled=true; btn.textContent='Criando‚Ä¶';
      try{
        const cred = await createUserWithEmailAndPassword(auth, $('#regEmail').value, $('#regPass').value);
        if($('#regName').value) await updateProfile(cred.user,{displayName:$('#regName').value});
        goApp(); // garante entrada imediata
      }catch(e){ $('#errReg').textContent = e.message.replace('Firebase:','').trim(); }
      finally{ btn.disabled=false; btn.textContent=old; }
    };
    $('#btnGoogle').onclick = async()=>{ try{ await signInWithPopup(auth,new GoogleAuthProvider()); }catch(e){ $('#errLogin').textContent=e.message; } };
    $('#btnApple').onclick = async()=>{ try{ const p=new OAuthProvider('apple.com'); p.addScope('email'); p.addScope('name'); await signInWithPopup(auth,p); }catch(e){ $('#errLogin').textContent=e.message+"\n(Configure o Apple no Firebase e Apple Developer)"; } };

    // ===== Guard =====
    onAuthStateChanged(auth,(user)=>{ if(user) goApp(); else goAuth(); });
    function goApp(){ $('#scrAuth').classList.remove('active'); $('#scrAuth').classList.add('hidden'); $('#scrApp').classList.add('active'); $('#userName').textContent = (auth.currentUser?.displayName)|| (auth.currentUser?.email)||''; initMonth(); attachListener(); }
    function goAuth(){ $('#scrApp').classList.remove('active'); $('#scrApp').classList.add('hidden'); $('#scrAuth').classList.remove('hidden'); $('#scrAuth').classList.add('active'); }

    // ===== Bottom nav (atalho entre views) =====
    $$('.navb button').forEach(b=> b.onclick=()=>{ $$('.navb button').forEach(x=>x.classList.remove('active')); b.classList.add('active'); showView(b.dataset.view); });
    function showView(v){ ['Resumo','Lanc','Lista','Sim'].forEach(name=> $('#view'+name).classList.toggle('hidden', name!==v)); }

    // ===== Month + Firestore =====
    function initMonth(){ const now=new Date(); $('#fltMonth').value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`; $('#txDate').value=ymd(new Date()); }
    $('#fltMonth').addEventListener('change', attachListener);
    function userCol(path){ return collection(db, `users/${auth.currentUser.uid}/${path}`); }

    function attachListener(){ if(unsub) unsub(); const [y,m] = $('#fltMonth').value.split('-').map(Number); const start = Timestamp.fromDate(new Date(y,m-1,1)); const end   = Timestamp.fromDate(new Date(y,m,0,23,59,59,999)); const q = query(userCol('transactions'), where('date','>=',start), where('date','<=',end), orderBy('date','desc')); unsub = onSnapshot(q,(snap)=>{ txCache = snap.docs.map(d=>({id:d.id,...d.data()})); refreshUI(); }); }

    function refreshUI(){ const totR = txCache.filter(t=>t.type==='receita').reduce((a,b)=>a+b.amount,0); const totD = txCache.filter(t=>t.type==='despesa').reduce((a,b)=>a+b.amount,0); $('#kpiRec').textContent=brl(totR); $('#kpiDes').textContent=brl(totD); $('#kpiSaldo').textContent=brl(totR-totD); const set=new Set(['Sal√°rio','Alimenta√ß√£o','Transporte','Moradia','Lazer','Sa√∫de','Educa√ß√£o','Investimentos','Outros']); txCache.forEach(t=>set.add(t.cat)); const opts='<option value="">Todas</option>'+Array.from(set).map(c=>`<option>${c}</option>`).join(''); $('#fltCat').innerHTML=opts; $('#fltCat2').innerHTML=opts; renderList($('#listHome'), txCache.slice(0,8)); renderList($('#listFull'), filterCat($('#fltCat2').value)); }

    function filterCat(cat){ return cat? txCache.filter(t=>t.cat===cat): txCache }
    $('#fltCat').onchange=()=> renderList($('#listHome'), filterCat($('#fltCat').value).slice(0,8));
    $('#fltCat2').onchange=()=> renderList($('#listFull'), filterCat($('#fltCat2').value));

    function renderList(container, rows){ container.innerHTML=''; rows.forEach(r=>{ const el=document.createElement('div'); el.className='item'; const bubble=`<div class="bubble ${r.type==='receita'?'b-r':'b-d'}">${r.type==='receita'?'+':'‚àí'}</div>`; el.innerHTML=`<div class="it-left">${bubble}<div><div style="font-weight:800">${r.cat||'‚Äî'} ‚Ä¢ <span class="sm">${fmtDate(r.date.toDate())}</span></div><div class="sm">${r.note||''}</div></div></div><div class="it-right"><div class="tag ${r.type==='receita'?'r':'d'}">${r.type==='despesa'?'-':''}${brl(r.amount)}</div><button class="btn warn btn-edit">Editar</button><button class="btn danger btn-del">Excluir</button></div>`; el.querySelector('.btn-edit').onclick=()=> startEdit(r); el.querySelector('.btn-del').onclick=()=> delTx(r.id); container.appendChild(el); }); }

    // ===== Create/Edit =====
    $('#btnTipoR').onclick=()=>{ currentType='receita'; };
    $('#btnTipoD').onclick=()=>{ currentType='despesa'; };
    $('#btnCancelarEdit').onclick=()=>{ editingId=null; $('#btnCancelarEdit').classList.add('hidden'); $('#btnSalvar').textContent='Salvar lan√ßamento'; clearForm(); };

    function clearForm(){ currentType='despesa'; $('#txDate').value=ymd(new Date()); $('#txCat').value=''; $('#txAmount').value=''; $('#txNote').value=''; $('#formInfo').textContent=''; }
    async function delTx(id){ if(confirm('Excluir este lan√ßamento?')) await deleteDoc(doc(userCol('transactions'), id)); }
    function startEdit(r){ editingId = r.id; currentType = r.type; $('#txDate').value=ymd(r.date.toDate()); $('#txCat').value=r.cat; $('#txAmount').value=r.amount; $('#txNote').value=r.note||''; $('#btnSalvar').textContent='Atualizar'; $('#btnCancelarEdit').classList.remove('hidden'); showView('Lanc'); window.scrollTo({top:0,behavior:'smooth'}); }

    $('#btnSalvar').onclick = async()=>{ const payload={ type: currentType, date: $('#txDate').value? Timestamp.fromDate(new Date($('#txDate').value)):Timestamp.now(), cat: ($('#txCat').value||'Outros').trim(), amount: Number($('#txAmount').value||0), note: $('#txNote').value.trim(), createdAt: Timestamp.now() }; if(!payload.amount||payload.amount<=0){ alert('Informe um valor v√°lido.'); return; } try{ if(editingId) await updateDoc(doc(userCol('transactions'), editingId), payload); else await addDoc(userCol('transactions'), payload); $('#formInfo').textContent='Salvo com sucesso.'; clearForm(); editingId=null; setTimeout(()=>{showView('Resumo')},250); }catch(e){ alert('Erro: '+e.message); } };

    // ===== CSV Export =====
    $('#btnCSV').onclick=()=>{ const rows = [['Data','Tipo','Categoria','Observa√ß√£o','Valor']]; txCache.forEach(t=> rows.push([fmtDate(t.date.toDate()), t.type, t.cat, (t.note||'').replace(/\n/g,' '), (t.type==='despesa'?'-':'')+t.amount.toFixed(2)])); const csv = rows.map(r=> r.map(x=>`"${String(x).replace(/"/g,'\"')}"`).join(',')).join('\n'); const blob = new Blob(["\ufeff"+csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='lancamentos.csv'; a.click(); };

    // ===== Simulador =====
    $('#btnSimular').onclick=()=>{ const P=Number($('#simInicial').value||0), PMT=Number($('#simMensal').value||0), i=Number($('#simTaxa').value||0)/100, n=Math.max(1,Number($('#simMeses').value||1)); let saldo=P; for(let m=1;m<=n;m++) saldo=saldo*(1+i)+PMT; const invest=P+PMT*n; const ganho=saldo-invest; $('#simOut').textContent=`Final: ${brl(saldo)} ‚Ä¢ Investido: ${brl(invest)} ‚Ä¢ Ganho: ${brl(ganho)}`; };

    // ===== Sair =====
    $('#btnSair').onclick=()=> signOut(auth);
  </script>
</body>
</html>
