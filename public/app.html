<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kratos System Finan√ßas Pessoais</title>
<link rel="icon" href="/static/logo.png" type="image/png" />
<style>
  :root {
    --azul: #163772;
    --azul-claro: #2a4172;
    --preto: #0b101e;
    --card-dark: #182336;
    --cinza: #232a39;
    --verde: #24c176;
    --vermelho: #e14c54;
    --amarelo: #ffd26e;
    --text-dark: #e6eefc;
    --sidebar: #131b2d;
    --sidebar-active: #222b44;
  }
  html, body {
    margin:0; padding:0; height:100%;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--cinza);
    color: var(--text-dark);
  }
  .container {
    display: flex;
    min-height: 100vh;
    width: 100vw;
    overflow-x: hidden;
  }
  aside.sidebar {
    background: var(--sidebar);
    color: var(--text-dark);
    width: 230px;
    min-width: 160px;
    padding: 2.2rem 1rem 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 10;
    transition: left 0.2s ease;
  }
  .logo {
    width: 56px;
    margin-bottom: 1rem;
    border-radius: 50%;
    background: white;
    padding: 8px;
  }
  .sidebar h1 {
    font-size: 1.18rem;
    margin: 0 0 .2rem 0;
  }
  .sidebar h2 {
    font-size: 1.01rem;
    margin-bottom: 1.1rem;
    font-weight: 400;
  }
  nav ul {
    list-style: none;
    padding: 0;
    width: 100%;
  }
  nav li {
    padding: .67rem 1rem;
    border-radius: 1rem;
    margin-bottom: .37rem;
    text-align: center;
    cursor: pointer;
    transition: background 0.15s ease;
    user-select: none;
  }
  nav li.active, nav li:hover {
    background: var(--sidebar-active);
    font-weight: 700;
    color: var(--amarelo);
  }
  .logout-btn {
    background: var(--vermelho);
    color: white;
    border: none;
    border-radius: 1rem;
    margin-top: 2rem;
    padding: .5rem 1.2rem;
    cursor: pointer;
    font-weight: 700;
    width: 100%;
  }
  main.main {
    flex: 1;
    padding: 2.2rem 1rem;
    min-width: 0;
    width: 100%;
    overflow-y: auto;
  }
  .panel {
    display: none;
  }
  .panel.active {
    display: block;
    animation: fadeIn 0.4s ease forwards;
  }
  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
  }
  /* FAB button */
  .fab {
    position: fixed;
    bottom: 2.2rem;
    right: 2rem;
    z-index: 110;
    background: var(--azul);
    color: white;
    width: 58px;
    height: 58px;
    border-radius: 50%;
    font-size: 2.4rem;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 16px #246bfd30;
    cursor: pointer;
  }
  .fab:hover {
    background: #193b70;
  }
  /* Modal */
  .modal-bg {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.7);
    align-items: center;
    justify-content: center;
    z-index: 50;
  }
  .modal-bg.active {
    display: flex;
  }
  .modal {
    background: var(--card-dark);
    color: var(--text-dark);
    border-radius: 1rem;
    padding: 1.5rem 1rem;
    min-width: 320px;
    max-width: 90vw;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .modal form label {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
    margin-bottom: 0.7rem;
    font-weight: 500;
  }
  .modal form input, .modal form select, .modal form textarea {
    padding: 0.4rem;
    border-radius: 0.5rem;
    border: 1px solid #2b3552;
    font-size: 1rem;
    background: #192132;
    color: var(--text-dark);
  }
  .modal form button {
    padding: 0.6rem 1.4rem;
    border-radius: 0.9rem;
    border: none;
    background: var(--azul);
    color: white;
    font-size: 1rem;
    margin-right: 0.5rem;
    cursor: pointer;
    margin-top: 0.4rem;
  }
  .modal form button[type=button] {
    background: #333;
    color: #eee;
  }
  /* Responsivo simples */
  @media (max-width: 600px) {
    .container {
      flex-direction: column;
    }
    aside.sidebar {
      width: 100%;
      min-width: auto;
      flex-direction: row;
      padding: 0.5rem 1rem;
      overflow-x: auto;
    }
    .logo {
      width: 40px;
      margin: 0 1rem 0 0;
      background: white;
      padding: 6px;
    }
    nav ul {
      display: flex;
      gap: 1rem;
      width: auto;
    }
    nav li {
      margin-bottom: 0;
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      white-space: nowrap;
    }
    .logout-btn {
      margin-top: 0;
      margin-left: auto;
      padding: 0.3rem 0.8rem;
      border-radius: 0.5rem;
      width: auto;
      font-size: 0.9rem;
    }
    main.main {
      padding: 1rem 0.5rem;
    }
    .fab {
      bottom: 1.5rem;
      right: 1.5rem;
      width: 50px;
      height: 50px;
      font-size: 2rem;
    }
  }
</style>
</head>
<body>

<div class="container">
  <aside class="sidebar" id="sidebar">
    <img src="/static/logo.png" alt="Logo Kratos" class="logo" />
    <h1>Kratos System</h1>
    <h2>Finan√ßas Pessoais</h2>
    <nav>
      <ul id="menuList"></ul>
    </nav>
    <button class="logout-btn" id="logoutBtn">Sair</button>
  </aside>

  <main class="main" id="mainPainel">
    <section id="dashboard" class="panel active"></section>
    <section id="transactions" class="panel"></section>
    <section id="metas" class="panel"></section>
    <section id="contas" class="panel"></section>
    <section id="categorias" class="panel"></section>
    <section id="relatorios" class="panel"></section>
    <section id="configuracoes" class="panel"></section>
  </main>
</div>

<div class="fab" id="fabBtn" title="Adicionar lan√ßamento">+</div>

<div class="modal-bg" id="modal" onclick="closeModal(event)"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD32JNIb-IplbuAM8WD-Nw_P3gA5wNSNwY",
    authDomain: "kratosfinancas.firebaseapp.com",
    projectId: "kratosfinancas",
    storageBucket: "kratosfinancas.firebasestorage.app",
    messagingSenderId: "740158664268",
    appId: "1:740158664268:web:9e4583e75c94cbd90c0ee9"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  const MENUS = [
    {id:"dashboard", label:"Dashboard", icon:"üìä"},
    {id:"transactions", label:"Lan√ßamentos", icon:"üí∏"},
    {id:"metas", label:"Metas", icon:"üéØ"},
    {id:"contas", label:"Contas", icon:"üè¶"},
    {id:"categorias", label:"Categorias", icon:"üè∑Ô∏è"},
    {id:"relatorios", label:"Relat√≥rios", icon:"üìà"},
    {id:"configuracoes", label:"Configura√ß√µes", icon:"‚öôÔ∏è"},
  ];

  let appData = null;
  let userEmail = null;

  const menuList = document.getElementById("menuList");
  const fabBtn = document.getElementById("fabBtn");
  const modal = document.getElementById("modal");

  // Renderiza menu e adiciona evento para carregar painel
  function renderMenu() {
    menuList.innerHTML = "";
    MENUS.forEach(m => {
      const li = document.createElement("li");
      li.id = "menu-" + m.id;
      li.textContent = m.icon + " " + m.label;
      li.style.userSelect = "none";
      li.onclick = () => {
        showPanel(m.id);
      };
      menuList.appendChild(li);
    });
  }

  // Mostra painel e ativa menu correspondente
  function showPanel(id) {
    document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
    const panel = document.getElementById(id);
    if (panel) panel.classList.add("active");
    document.querySelectorAll("#menuList li").forEach(li => li.classList.remove("active"));
    const menuItem = document.getElementById("menu-" + id);
    if (menuItem) menuItem.classList.add("active");

    // Carrega conte√∫do din√¢mico
    if(id === "dashboard") {
      loadDashboard();
      fabBtn.style.display = "none";
    } else if(id === "transactions") {
      loadTransactions();
      fabBtn.style.display = "flex";
    } else {
      fabBtn.style.display = "none";
      const panel = document.getElementById(id);
      if(panel) panel.innerHTML = `<h2>${id}</h2><p>Conte√∫do n√£o implementado ainda.</p>`;
    }
  }

  // Fun√ß√£o que carrega o dashboard
  function loadDashboard() {
    const dash = document.getElementById("dashboard");
    if(!dash) return;
    dash.innerHTML = `<h2>Dashboard</h2><p>Bem-vindo, ${userEmail}!</p>`;
    // Aqui voc√™ pode colocar gr√°ficos, saldo, etc
  }

  // Fun√ß√£o que carrega lan√ßamentos
  function loadTransactions() {
    const trans = document.getElementById("transactions");
    if(!trans) return;

    trans.innerHTML = `
      <h2>Lan√ßamentos</h2>
      <p>Lista de transa√ß√µes:</p>
      <table style="width:100%;border-collapse:collapse;color:#000;background:#fff;border-radius:8px;overflow:hidden;">
        <thead>
          <tr>
            <th style="padding:8px;border-bottom:2px solid #ccc;">Descri√ß√£o</th>
            <th style="padding:8px;border-bottom:2px solid #ccc;">Valor</th>
            <th style="padding:8px;border-bottom:2px solid #ccc;">Data</th>
          </tr>
        </thead>
        <tbody id="transactionsTableBody"></tbody>
      </table>
    `;

    const tbody = document.getElementById("transactionsTableBody");
    tbody.innerHTML = "";
    if(appData && appData.transacoes && appData.transacoes.length > 0) {
      appData.transacoes.forEach(tx => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td style="padding:8px;border-bottom:1px solid #ddd;">${tx.description || ""}</td>
          <td style="padding:8px;border-bottom:1px solid #ddd;">R$ ${tx.value.toFixed(2)}</td>
          <td style="padding:8px;border-bottom:1px solid #ddd;">${tx.date || ""}</td>
        `;
        tbody.appendChild(tr);
      });
    }
  }

  // Fun√ß√£o para abrir modal de novo lan√ßamento
  function openModal() {
    modal.innerHTML = `
      <div class="modal" onclick="event.stopPropagation()">
        <h3>Novo lan√ßamento</h3>
        <form id="newTransactionForm">
          <label>Descri√ß√£o:
            <input type="text" id="txDescription" required />
          </label>
          <label>Valor:
            <input type="number" id="txValue" step="0.01" required />
          </label>
          <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button type="submit">Salvar</button>
            <button type="button" id="btnCancel">Cancelar</button>
          </div>
        </form>
      </div>
    `;
    modal.classList.add("active");

    document.getElementById("btnCancel").onclick = closeModal;

    document.getElementById("newTransactionForm").onsubmit = e => {
      e.preventDefault();
      if(!appData.transacoes) appData.transacoes = [];
      appData.transacoes.push({
        description: document.getElementById("txDescription").value,
        value: parseFloat(document.getElementById("txValue").value),
        date: new Date().toISOString().slice(0,10)
      });
      saveData();
      closeModal();
      loadTransactions();
    };
  }

  // Fecha modal
  function closeModal() {
    modal.classList.remove("active");
    modal.innerHTML = "";
  }

  modal.onclick = e => {
    if(e.target === modal) closeModal();
  };

  fabBtn.onclick = () => {
    openModal();
  };

  // Salva dados no Firestore
  function saveData() {
    if(!userEmail) return;
    db.collection("usuarios").doc(userEmail).set(appData);
  }

  // Carrega dados do usu√°rio no Firestore
  function loadUserData() {
    if(!userEmail) return;
    db.collection("usuarios").doc(userEmail).get().then(doc => {
      if(doc.exists) {
        appData = doc.data();
      } else {
        appData = {
          user: userEmail,
          contas: [{ nome: "Carteira", saldo: 0, cor: "#246bfd" }],
          categorias: [
            { nome: "Sal√°rio", tipo: "income", cor: "#24c176" },
            { nome: "Alimenta√ß√£o", tipo: "expense", cor: "#e14c54" }
          ],
          transacoes: [],
          metas: [],
          config: { theme: "dark", alertas: [], limites: {}, excelSep: ";" },
          anexos: {}
        };
        saveData();
      }
      renderMenu();
      showPanel("dashboard");
      fabBtn.style.display = "flex";
    });
  }

  // Controla autentica√ß√£o
  auth.onAuthStateChanged(user => {
    if(!user) {
      window.location.href = "login.html";
      return;
    }
    userEmail = user.email;
    loadUserData();
  });

  // Logout
  document.getElementById("logoutBtn").onclick = () => {
    auth.signOut().then(() => {
      window.location.href = "login.html";
    });
  };
</script>

</body>
</html>
