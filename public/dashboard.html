<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Kratos System</title>
<style>
  :root {
    --azul: #163772;
    --azul-claro: #2a4172;
    --verde: #24c176;
    --vermelho: #e14c54;
    --amarelo: #ffd26e;
    --card-dark: #182336;
    --text-dark: #e6eefc;
    --cinza: #232a39;
  }
  body {
    margin: 0; padding: 2rem;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--cinza);
    color: var(--text-dark);
  }
  h2 { margin-bottom: 1rem; }
  .resume-cards {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-bottom: 1.7rem;
  }
  .card {
    background: var(--card-dark);
    padding: 1rem 1.5rem;
    border-radius: 1.2rem;
    min-width: 120px;
    flex: 1 0 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 0 2px 10px #0001;
    border-bottom: 3px solid transparent;
  }
  .card.receita { border-bottom-color: var(--verde); }
  .card.despesa { border-bottom-color: var(--vermelho); }
  .card.total { border-bottom-color: var(--azul); }
  .card span {
    color: #8c9fc5;
    margin-bottom: 0.3rem;
  }
  .card strong {
    font-size: 1.24rem;
  }
  #chart {
    max-width: 100%;
  }
  .alerta {
    background: var(--vermelho);
    color: white;
    border-radius: 1rem;
    padding: 1rem;
    margin-bottom: 1rem;
  }
  ul.dicas {
    color: var(--amarelo);
    line-height: 1.7;
    padding-left: 1.2rem;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<h2>Resumo Financeiro</h2>
<div id="alertaBox"></div>
<div class="resume-cards">
  <div class="card total">
    <span>Saldo Atual</span>
    <strong id="totalBalance">R$ 0,00</strong>
  </div>
  <div class="card receita">
    <span>Receitas</span>
    <strong id="totalIncome">R$ 0,00</strong>
  </div>
  <div class="card despesa">
    <span>Despesas</span>
    <strong id="totalExpense">R$ 0,00</strong>
  </div>
</div>
<canvas id="chart" width="350" height="160"></canvas>
<div style="margin-top:1.6rem;">
  <b>Dicas r√°pidas:</b>
  <ul class="dicas">
    <li>Clique no bot√£o ‚Äú+‚Äù para registrar rapidamente uma receita, despesa ou transfer√™ncia.</li>
    <li>Acompanhe suas <b>metas</b> na aba Metas üéØ e veja seu progresso mensal.</li>
    <li>Adicione <b>contas</b> para controlar saldo em bancos, cart√µes, ou dinheiro f√≠sico.</li>
    <li>Personalize categorias e defina <b>limites</b> para receber alertas.</li>
    <li>Baixe backups regulares em <b>Configura√ß√µes</b> para nunca perder seus dados.</li>
  </ul>
</div>

<script>
  // Supondo que appData est√° dispon√≠vel globalmente
  // Para demo, criaremos dados est√°ticos (remova se usar seu app real)
  let appData = {
    contas: [{ saldo: 1500 }, { saldo: 500 }],
    transacoes: [
      { type: "income", value: 2500, category: "Sal√°rio" },
      { type: "expense", value: 800, category: "Alimenta√ß√£o" },
      { type: "expense", value: 200, category: "Transporte" }
    ],
    config: {
      limites: {
        Alimenta√ß√£o: 700
      }
    }
  };

  function renderDashboard() {
    const totalBalance = appData.contas.reduce((sum, c) => sum + c.saldo, 0);
    const totalIncome = appData.transacoes
      .filter(tx => tx.type === "income")
      .reduce((sum, tx) => sum + tx.value, 0);
    const totalExpense = appData.transacoes
      .filter(tx => tx.type === "expense")
      .reduce((sum, tx) => sum + tx.value, 0);

    document.getElementById("totalBalance").textContent = totalBalance.toLocaleString("pt-BR", {style:"currency", currency:"BRL"});
    document.getElementById("totalIncome").textContent = totalIncome.toLocaleString("pt-BR", {style:"currency", currency:"BRL"});
    document.getElementById("totalExpense").textContent = totalExpense.toLocaleString("pt-BR", {style:"currency", currency:"BRL"});

    // Mostrar alertas limites
    const alertBox = document.getElementById("alertaBox");
    alertBox.innerHTML = "";
    Object.entries(appData.config.limites).forEach(([cat, limite]) => {
      let gastoCat = appData.transacoes
        .filter(tx => tx.category === cat && tx.type === "expense")
        .reduce((sum, tx) => sum + tx.value, 0);
      if (limite > 0 && gastoCat > limite) {
        alertBox.innerHTML += `<div class="alerta">Aten√ß√£o: categoria <b>${cat}</b> ultrapassou o limite (${gastoCat.toLocaleString("pt-BR", {style:"currency", currency:"BRL"})} / ${limite.toLocaleString("pt-BR", {style:"currency", currency:"BRL"})})</div>`;
      }
    });

    // Chart doughnut despesas por categoria
    let expenseByCategory = {};
    appData.transacoes.filter(tx => tx.type === "expense").forEach(tx => {
      expenseByCategory[tx.category] = (expenseByCategory[tx.category] || 0) + tx.value;
    });

    const ctx = document.getElementById('chart').getContext('2d');
    if(window.dashChart) window.dashChart.destroy();
    window.dashChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(expenseByCategory),
        datasets: [{
          data: Object.values(expenseByCategory),
          backgroundColor: ['#163772', '#24c176', '#e14c54', '#ffd26e', '#9b59b6', '#16a085', '#aaa']
        }]
      },
      options: {
        plugins: {
          legend: {
            display: true
          }
        }
      }
    });
  }

  renderDashboard();
</script>
</body>
</html>
